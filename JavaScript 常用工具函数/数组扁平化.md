# 数组扁平化

将一个嵌套任意层的数组 array 转换为只有一层的数组。

## 普通递归

```javascript
function flatten(array) {
  let result = [];
  array.forEach(el => {
    // if (Array.isArray(el)) {
    //   result = result.concat(flatten(el))
    // } else {
    //   result = result.concat(el)
    // }
    result = result.concat(Array.isArray(el) ? flatten(el) : el);
  });
  return result;
}

const arr = [1, [2, [3, 4]], 5, 6, [7, 8]];
console.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7, 8 ]
```

## reduce 递归

`arr.reduce(callback[, initialValue])`

reduce 方法接收一个函数 callback 作为累加器（accumulator），数组中的每个值（从左到右）开始合并，返回一个值。

* callback：数组里每个元素执行的方法。
* initialValue：初始值。

`function callback(accumulator, currentValue, index, array){}`

* accumulator: 累加器，是上一次调用 callback 的返回值，或者是提供的初始值（initialValue）。
* currentValue: 数组中当前被处理的数组项。
* index: 当前数组项在数组中的索引值。
* array: 调用 reduce() 方法的数组。

如果存在 initialValue，则第一次调用 callback 时，acc 为 initialValue，currentValue 为 arr[0]；如果不存在 initialValue，则第一次调用 callback 时，acc 为 arr[0]，currentValue 为 arr[1]

```javascript
// 扁平一级，测试 reduce
const arr = [[1], [2, [3, 4]], 5, 6, [7, 8]];
result = arr.reduce((acc, cur) => {
  return acc.concat(cur);
}, []);
console.log(result); // [ 1, 2, [ 3, 4 ], 5, 6, 7, 8 ]

// 全部扁平
function flatten(array) {
  return array.reduce((acc, cur) => {
    return acc.concat(Array.isArray(cur) ? flatten(cur) : cur);
  }, []);
}

console.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7, 8 ]
```

## ...

扩展运算符 ... 可以扁平化一层，循环使用就可以达到目的。

```javascript
// 扁平一级，测试 ...
const arr = [1, [2, [3, 4]], 5, 6, [7, 8]];
console.log([].concat(...arr)); // [ 1, 2, [ 3, 4 ], 5, 6, 7, 8 ]

// 全部扁平
function flatten(array) {
  while (array.some(el => Array.isArray(el))) {
    array = [].concat(...array);
  }
  return array;
}

console.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7, 8 ]
```

## toString

只适用于数组里只有数字的情况。例如 [1, '2', [3, 4]] 不适用。结果是 [1, 2, 3, 4]， 事实上，应该是 [1, '2', 3, 4]。

```javascript
// 方案 1
function flatten(array) {
  return array
    .toString()
    .split(',')
    .map(el => +el);
}

// 方案 2
function flatten2(array) {
  const arrStr = array.toString();
  return JSON.parse('[' + arrStr + ']');
}

const arr = [1, [2, [3, 4]], 5, 6, [7, 8]];
console.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7, 8 ]
console.log(flatten2(arr)); // [ 1, 2, 3, 4, 5, 6, 7, 8 ]
```

## 正则表达式

利用正则表达式去掉中括号。

```javascript
// 方案 1
function flatten(array) {
  const arrStr = JSON.stringify(array).replace(/\[|\]/g, '');
  return arrStr.split(',').map(el => +el);
}

// 方案 2
function flatten2(array) {
  const arrStr = JSON.stringify(array).replace(/\[|\]/g, '');
  return JSON.parse('[' + arrStr + ']');
}

const arr = [1, [2, [3, 4]], 5, 6, [7, 8]];
console.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7, 8 ]
console.log(flatten2(arr)); // [ 1, 2, 3, 4, 5, 6, 7, 8 ]
```

## 参考

1. mqyqingfeng [JavaScript 专题之数组扁平化](https://github.com/mqyqingfeng/Blog/issues/36)
